{% extends "template.html" %}
{% block content %}
<div id="questionModal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title"></p>
        </header>
        <section class="modal-card-body">
        </section>
        <footer class="modal-card-foot">
            <!-- Statistics go here -->
            <button class="button is-success confirm"> Changes</button>
            <button class="button cancel">Cancel</button>
        </footer>
    </div>
</div>

<script>
    function openModalQuestion(questionID, /*onConfirm*/ /*, onCancel*/) {
        var modal = document.getElementById('questionModal');

        const closeModal = function () {
            modal.querySelector('button.confirm').removeEventListener('click', confirmEvent)
            modal.querySelector('button.cancel').removeEventListener('click', cancelEvent)
            modal.querySelector('.modal-background').removeEventListener('click', cancelEvent)
            modal.classList.remove('is-active');
        }

        const confirmEvent = function (evt) {
            evt.target.classList.add('is-loading')
            fetch('delete', {
                method: 'post',
                body: JSON.stringify({id: noticeID})
            })
                .then(response => response.json())
                .then(jsonData => {
                    evt.target.classList.remove('is-loading')
                    if (jsonData.status) {
                        var tile = document.getElementById('tile' + noticeID).parentElement.parentElement
                        tile.parentElement.removeChild(tile)
                        // reflow()
                        closeModal();
                    } else {
                        // what to do if there's an error?
                    }
                })
        }

        const cancelEvent = function (evt) {
            // onCancel && onCancel();
            closeModal();
        }

        modal.querySelector('button.confirm').addEventListener('click', confirmEvent)
        modal.querySelector('button.cancel').addEventListener('click', cancelEvent)
        modal.querySelector('.modal-background').addEventListener('click', cancelEvent)

        modal.classList.add('is-active');
    }
    </script>

<div class="container">
    <div class="tile is-ancestor is-unselectable">
        <div class="tile is-parent"></div>
    </div>
</div>



<script>
    function dataToTile(data) {
        tile = document.createElement('article')
        tile.classList.add("tile", "is-child", "notification", "is-3")
        tile.classList.add("is-info")

        title = document.createElement('p')
        title.classList.add("title")
        title.innerText = data.title

        tile.addEventListener('click', function () {
            openModalEdit(data.id, this)
        })

        tile.appendChild(title)

        return tile
    }

    var questions = {};
    var questionsByCategory = {};
    fetch('/api/v1/ctf/questions.json', {
        method: 'post',
    })
        .then(response => response.json())
        .then(jsonData => {
            if (jsonData.status) {
                for (var data of jsonData.data || []) {
                    questions[data[0]] = {
                        id: data[0],
                        title: data[1],
                        description: data[2],
                        value: data[3],
                        category: data[4]
                    };
                    if (!questionsByCategory.hasOwnProperty(data[4])) {
                        questionsByCategory[data[4]] = [];
                        questionsByCategory[data[4]].push(data[0])
                    }
                    document.querySelector('div.tile.is-ancestor .is-parent').appendChild(dataToTile(questions[data[0]]))
                }
            }
        })

    var categories = {};
    fetch('/api/v1/ctf/categories.json', {
        method: 'post',
    })
        .then(response => response.json())
        .then(jsonData => {
            if (jsonData.status) {
                for (var data of jsonData.data || []) {
                    categories[data[0]] = data[1]
                }
            }
        })

    var solves = [];
    fetch('/api/v1/ctf/solves.json', {
        method: 'post',
    })
        .then(response => response.json())
        .then(jsonData => {
            if (jsonData.status) {
                if (jsonData.data) {
                    solves = jsonData.data
                }
            }
        })


</script>





<style>
    body > div.container {
        pointer-events: none;
    }

    article {
        cursor: pointer;
        border: 1px #dbdbdb !important;
    }


    article.tile {
        transition: all 0.3s;
    }

    div.tile.is-ancestor .is-parent {
        flex-flow: wrap;
    }

    article.tile.is-child {
        margin: 5px !important;
        pointer-events: auto;
    }

    @media screen and (min-width: 769px) {
        article.tile.is-child {
            width: 25%;
            min-height: 25vh;
        }
    }

</style>
{% endblock %}